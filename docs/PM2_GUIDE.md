# PM2 æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [PM2åŸºç¡€å‘½ä»¤](#pm2åŸºç¡€å‘½ä»¤)
3. [æ—¥å¿—ç®¡ç†](#æ—¥å¿—ç®¡ç†)
4. [ç›‘æ§å’Œå‘Šè­¦](#ç›‘æ§å’Œå‘Šè­¦)
5. [è¿›ç¨‹ç®¡ç†](#è¿›ç¨‹ç®¡ç†)
6. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬1æ­¥ï¼šå®‰è£…PM2

```bash
npm install -g pm2
```

### ç¬¬2æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

ç¡®ä¿ `.env` æ–‡ä»¶å·²é…ç½®ï¼ˆæœåŠ¡å™¨ç¯å¢ƒå»ºè®®è®¾ç½®ï¼‰ï¼š

```bash
# å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶
cp env.example .env

# ç¼–è¾‘é…ç½®
nano .env
```

**é‡è¦é…ç½®é¡¹ï¼š**

```env
# å¸å®‰APIï¼ˆå¿…å¡«ï¼‰
BINANCE_API_KEY=your_api_key_here
BINANCE_API_SECRET=your_api_secret_here

# æœåŠ¡å™¨ç¯å¢ƒä¸éœ€è¦ä»£ç†
USE_PROXY=false

# æ—¥å¿—çº§åˆ«
LOG_LEVEL=info
```

### ç¬¬3æ­¥ï¼šè¿è¡Œéƒ¨ç½²è„šæœ¬

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x deploy-live.sh

# è‡ªåŠ¨éƒ¨ç½²ï¼ˆä½¿ç”¨æœ€æ–°çš„é…ç½®æ–‡ä»¶ï¼‰
./deploy-live.sh

# æˆ–æŒ‡å®šé…ç½®æ–‡ä»¶
./deploy-live.sh ./output/live_trading_config_1761638276782.json
```

### ç¬¬4æ­¥ï¼šæ£€æŸ¥è¿è¡ŒçŠ¶æ€

```bash
pm2 list
```

---

## ğŸ“Œ PM2åŸºç¡€å‘½ä»¤

### å¯åŠ¨å’Œåœæ­¢

```bash
# å¯åŠ¨å®ç›˜äº¤æ˜“
pm2 start ecosystem.config.cjs

# åœæ­¢äº¤æ˜“
pm2 stop stat-arb

# é‡å¯äº¤æ˜“
pm2 restart stat-arb

# åˆ é™¤è¿›ç¨‹
pm2 delete stat-arb

# é‡è½½é…ç½®ï¼ˆæ— ç¼é‡å¯ï¼‰
pm2 reload stat-arb
```

### æŸ¥çœ‹çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
pm2 list

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 show stat-arb

# å®æ—¶ç›‘æ§ï¼ˆCPUã€å†…å­˜ï¼‰
pm2 monit
```

---

## ğŸ“Š æ—¥å¿—ç®¡ç†

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
pm2 logs stat-arb

# æŸ¥çœ‹æœ€å100è¡Œ
pm2 logs stat-arb --lines 100

# åªçœ‹é”™è¯¯æ—¥å¿—
pm2 logs stat-arb --err

# åªçœ‹è¾“å‡ºæ—¥å¿—
pm2 logs stat-arb --out

# æ¸…ç©ºæ—¥å¿—
pm2 flush
```

### æ—¥å¿—æ–‡ä»¶ä½ç½®

- **PM2æ—¥å¿—**: `./logs/pm2-out.log` å’Œ `./logs/pm2-error.log`
- **ç­–ç•¥æ—¥å¿—**: `./logs/combined.log` å’Œ `./logs/error.log`
- **äº¤æ˜“æ—¥å¿—**: `./logs/trades.log`

### æ—¥å¿—è½®è½¬

PM2é…ç½®äº†è‡ªåŠ¨æ—¥å¿—è½®è½¬ï¼š
- å•ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§ 10MB
- ä¿ç•™æœ€è¿‘ 7 å¤©çš„æ—¥å¿—

æ‰‹åŠ¨å®‰è£…æ—¥å¿—è½®è½¬æ¨¡å—ï¼š

```bash
pm2 install pm2-logrotate

# é…ç½®æ—¥å¿—è½®è½¬
pm2 set pm2-logrotate:max_size 10M
pm2 set pm2-logrotate:retain 7
pm2 set pm2-logrotate:compress true
```

---

## ğŸ”” ç›‘æ§å’Œå‘Šè­¦

### åŸºç¡€ç›‘æ§

```bash
# å®æ—¶ç›‘æ§é¢æ¿
pm2 monit

# CPUå’Œå†…å­˜ä½¿ç”¨æƒ…å†µ
pm2 list
```

### Webç›‘æ§ï¼ˆPM2 Plusï¼‰

PM2 Plus æä¾›æ›´å¼ºå¤§çš„ç›‘æ§åŠŸèƒ½ï¼ˆå…è´¹ç‰ˆè¶³å¤Ÿç”¨ï¼‰ï¼š

```bash
# æ³¨å†Œå¹¶è¿æ¥
pm2 link <secret_key> <public_key>

# è®¿é—®ç½‘é¡µæ§åˆ¶å°
# https://app.pm2.io
```

**PM2 Plus åŠŸèƒ½ï¼š**
- ğŸ“Š å®æ—¶æ€§èƒ½ç›‘æ§
- ğŸ“ˆ å†å²æ•°æ®å›¾è¡¨
- ğŸ”” å¼‚å¸¸å‘Šè­¦ï¼ˆé‚®ä»¶/çŸ­ä¿¡ï¼‰
- ğŸ”„ è¿œç¨‹é‡å¯
- ğŸ“± æ‰‹æœºAppç›‘æ§

### è‡ªå®šä¹‰å‘Šè­¦

åœ¨ä»£ç ä¸­é›†æˆå‘Šè­¦ï¼ˆå·²åœ¨ç­–ç•¥ä¸­å®ç°ï¼‰ï¼š

```javascript
// ä¸¥é‡é”™è¯¯æ—¶å‘é€é€šçŸ¥
if (errorType === 'CRITICAL') {
  // å‘é€é‚®ä»¶/çŸ­ä¿¡/é’‰é’‰é€šçŸ¥
  notifyAdmin('ä¸¥é‡é”™è¯¯', error);
}
```

---

## âš™ï¸ è¿›ç¨‹ç®¡ç†

### å¼€æœºè‡ªå¯åŠ¨

```bash
# ç”Ÿæˆå¯åŠ¨è„šæœ¬
pm2 startup

# å¤åˆ¶å¹¶æ‰§è¡Œæ˜¾ç¤ºçš„å‘½ä»¤ï¼ˆéœ€è¦rootæƒé™ï¼‰
sudo env PATH=$PATH:/usr/bin pm2 startup systemd -u yourusername --hp /home/yourusername

# ä¿å­˜å½“å‰è¿›ç¨‹åˆ—è¡¨
pm2 save
```

### æ›´æ–°é…ç½®

**æ–¹æ³•1ï¼šä¿®æ”¹ ecosystem.config.cjs åé‡å¯**

```bash
# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano ecosystem.config.cjs

# é‡å¯åº”ç”¨
pm2 restart stat-arb
```

**æ–¹æ³•2ï¼šä½¿ç”¨æ–°çš„é…ç½®æ–‡ä»¶**

```bash
# åœæ­¢å½“å‰è¿›ç¨‹
pm2 stop stat-arb
pm2 delete stat-arb

# æ›´æ–°é…ç½®è·¯å¾„
# ç¼–è¾‘ ecosystem.config.cjs ä¸­çš„ args å‚æ•°

# é‡æ–°å¯åŠ¨
pm2 start ecosystem.config.cjs
pm2 save
```

### ç¯å¢ƒå˜é‡æ›´æ–°

```bash
# ä¿®æ”¹ .env æ–‡ä»¶
nano .env

# é‡å¯åº”ç”¨ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ
pm2 restart stat-arb --update-env
```

### èµ„æºé™åˆ¶

åœ¨ `ecosystem.config.cjs` ä¸­é…ç½®ï¼š

```javascript
{
  max_memory_restart: '500M',  // å†…å­˜è¶…é™è‡ªåŠ¨é‡å¯
  max_restarts: 10,            // å¼‚å¸¸é‡å¯æ¬¡æ•°é™åˆ¶
  min_uptime: '10s',           // æœ€å°è¿è¡Œæ—¶é—´
}
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### è¿›ç¨‹ä¸æ–­é‡å¯

```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs stat-arb --err --lines 50

# å¯èƒ½åŸå› ï¼š
# 1. APIè¿æ¥å¤±è´¥ï¼ˆæ£€æŸ¥ç½‘ç»œå’ŒAPIå¯†é’¥ï¼‰
# 2. é…ç½®æ–‡ä»¶é”™è¯¯
# 3. ä¾èµ–åŒ…ç¼ºå¤±ï¼ˆè¿è¡Œ npm installï¼‰
# 4. å†…å­˜ä¸è¶³
```

### æ— æ³•å¯åŠ¨

```bash
# æ£€æŸ¥PM2çŠ¶æ€
pm2 status

# å°è¯•æ‰‹åŠ¨è¿è¡ŒæŸ¥çœ‹è¯¦ç»†é”™è¯¯
node src/statistical-arbitrage/live-trading.js --config=./output/live_trading_config_xxx.json

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tunlp | grep node
```

### å†…å­˜å ç”¨è¿‡é«˜

```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
pm2 monit

# é™ä½å†…å­˜å ç”¨çš„æ–¹æ³•ï¼š
# 1. å‡å°‘ç›‘æ§çš„å¸å¯¹æ•°é‡
# 2. å¢åŠ æ•°æ®é‡‡é›†é—´éš”
# 3. è°ƒæ•´ max_memory_restart
```

### APIè¿æ¥é—®é¢˜

```bash
# æµ‹è¯•APIè¿æ¥
node test-api-connection.js

# æ£€æŸ¥ä»£ç†è®¾ç½®ï¼ˆæœåŠ¡å™¨åº”è¯¥è®¾ä¸º falseï¼‰
grep USE_PROXY .env

# æ£€æŸ¥IPç™½åå•
# ç™»å½•å¸å®‰ â†’ APIç®¡ç† â†’ æŸ¥çœ‹IPé™åˆ¶
```

### æ—¥å¿—å¤ªå¤šç£ç›˜å æ»¡

```bash
# æ¸…ç†æ—¥å¿—
pm2 flush

# æ‰‹åŠ¨åˆ é™¤æ—§æ—¥å¿—
rm -f logs/combined*.log
rm -f logs/trades*.log

# è®¾ç½®æ—¥å¿—è½®è½¬ï¼ˆè§ä¸Šæ–‡ï¼‰
```

---

## ğŸ“± è¿œç¨‹ç®¡ç†

### SSHè¿æ¥æœåŠ¡å™¨

```bash
ssh user@your-server-ip
```

### é€šè¿‡æ‰‹æœºç®¡ç†

1. å®‰è£… **Termux**ï¼ˆAndroidï¼‰æˆ– **Blink Shell**ï¼ˆiOSï¼‰
2. SSHè¿æ¥åˆ°æœåŠ¡å™¨
3. è¿è¡ŒPM2å‘½ä»¤

æˆ–ä½¿ç”¨ **PM2 Plus** ç½‘é¡µç‰ˆ/Appç‰ˆ

---

## ğŸ›¡ï¸ å®‰å…¨å»ºè®®

### 1. APIå¯†é’¥å®‰å…¨

- âœ… ä½¿ç”¨åªè¯»+äº¤æ˜“æƒé™ï¼ˆä¸è¦å¼€å¯æç°ï¼‰
- âœ… è®¾ç½®IPç™½åå•ï¼ˆæœåŠ¡å™¨å›ºå®šIPï¼‰
- âœ… å®šæœŸæ›´æ¢APIå¯†é’¥
- âœ… ä¸è¦åœ¨å…¬å…±ä»£ç åº“æäº¤ .env

### 2. æœåŠ¡å™¨å®‰å…¨

```bash
# é…ç½®é˜²ç«å¢™
sudo ufw enable
sudo ufw allow 22/tcp  # SSH

# ç¦ç”¨rootç™»å½•
sudo nano /etc/ssh/sshd_config
# è®¾ç½®ï¼šPermitRootLogin no

# ä½¿ç”¨SSHå¯†é’¥è®¤è¯
ssh-keygen
ssh-copy-id user@server
```

### 3. è¿›ç¨‹ç›‘æ§

- è®¾ç½®å¼‚å¸¸å‘Šè­¦
- å®šæœŸæ£€æŸ¥äº¤æ˜“è®°å½•
- è®¾ç½®æ¯æ—¥ç›ˆäºé™é¢

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. Node.jsä¼˜åŒ–

```bash
# åœ¨ ecosystem.config.cjs ä¸­å¢åŠ Node.jså‚æ•°
node_args: '--max-old-space-size=512'
```

### 2. æ•°æ®åº“ä¼˜åŒ–ï¼ˆå¦‚ä½¿ç”¨ï¼‰

- å®šæœŸæ¸…ç†å†å²æ•°æ®
- å»ºç«‹ç´¢å¼•
- ä½¿ç”¨ç¼“å­˜

### 3. ç½‘ç»œä¼˜åŒ–

- ä½¿ç”¨æœåŠ¡å™¨æ‰€åœ¨åŒºåŸŸæ¥è¿‘çš„äº¤æ˜“æ‰€API
- å¯ç”¨HTTP/2
- é…ç½®CDNï¼ˆå¦‚éœ€è¦ï¼‰

---

## ğŸ†˜ ç´§æ€¥åœæ­¢

å¦‚æœéœ€è¦ç«‹å³åœæ­¢æ‰€æœ‰äº¤æ˜“ï¼š

```bash
# æ–¹æ³•1ï¼šåœæ­¢PM2è¿›ç¨‹
pm2 stop stat-arb

# æ–¹æ³•2ï¼šç›´æ¥æ€æ‰è¿›ç¨‹
pm2 kill

# æ–¹æ³•3ï¼šç™»å½•å¸å®‰ç½‘é¡µæ‰‹åŠ¨å¹³ä»“
# æ‰“å¼€å¸å®‰ â†’ ç°è´§è´¦æˆ· â†’ æ‰‹åŠ¨å–å‡ºæ‰€æœ‰æŒä»“
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£ï¼š`docs/`
- PM2å®˜æ–¹æ–‡æ¡£ï¼šhttps://pm2.keymetrics.io/
- å¸å®‰APIæ–‡æ¡£ï¼šhttps://binance-docs.github.io/

---

## âœ… éƒ¨ç½²æ¸…å•

**å¯åŠ¨å‰æ£€æŸ¥ï¼š**

- [ ] Node.jså·²å®‰è£…ï¼ˆv14+ï¼‰
- [ ] PM2å·²å®‰è£…
- [ ] .envæ–‡ä»¶å·²é…ç½®ï¼ˆAPIå¯†é’¥ã€USE_PROXY=falseï¼‰
- [ ] é…ç½®æ–‡ä»¶å·²ç”Ÿæˆï¼ˆlive_trading_config_xxx.jsonï¼‰
- [ ] æœåŠ¡å™¨IPå·²åŠ å…¥å¸å®‰ç™½åå•
- [ ] APIè¿æ¥æµ‹è¯•é€šè¿‡
- [ ] äº†è§£æ­¢æŸå’Œé£é™©ç®¡ç†å‚æ•°
- [ ] è®¾ç½®äº†å‘Šè­¦æœºåˆ¶
- [ ] å‡†å¤‡å¥½åˆå§‹èµ„é‡‘

**å¯åŠ¨åç›‘æ§ï¼š**

- [ ] pm2 list ç¡®è®¤è¿›ç¨‹è¿è¡Œ
- [ ] pm2 logs æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯
- [ ] é¦–æ¬¡äº¤æ˜“åæ£€æŸ¥å¸å®‰è´¦æˆ·
- [ ] æ¯æ—¥æ£€æŸ¥ç›ˆäºå’ŒæŒä»“
- [ ] å®šæœŸå¤‡ä»½æ—¥å¿—å’Œé…ç½®

---

ç¥äº¤æ˜“é¡ºåˆ©ï¼ğŸ’°

