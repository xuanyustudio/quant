# 统计套利实盘交易指南

## ⚠️ 重要警告

**在开始实盘交易之前，请务必理解：**

1. 加密货币交易存在极高风险，可能导致全部本金损失
2. 回测结果不代表未来收益，实盘表现通常低于回测
3. 建议先用小额资金测试至少1-2周
4. 确保充分理解策略原理和风险管理

---

## 📋 实盘前检查清单

### ✅ 必须完成的准备工作

- [ ] **充分回测**：至少在3个不同时间段进行回测
- [ ] **参数优化**：优化 lookbackPeriod 和开仓/平仓阈值
- [ ] **小额测试**：用少量资金（如总资金的5-10%）测试1-2周
- [ ] **理解策略**：完全理解统计套利原理和失效情况
- [ ] **监控准备**：建立实时监控和报警机制
- [ ] **风险控制**：设置最大回撤、日亏损限制
- [ ] **资金准备**：确保有足够的流动资金应对保证金要求

### ⚠️ 当前系统缺少的关键功能

1. **实际交易执行模块** ❌ 缺失
   - 下单功能（市价单/限价单）
   - 订单状态跟踪
   - 成交确认和异常处理

2. **资金管理系统** ❌ 缺失
   - 多配对资金分配
   - 保证金计算和监控
   - 动态调整仓位

3. **风险监控模块** ⚠️ 部分功能
   - 实时PnL追踪
   - 回撤监控和熔断
   - 异常检测和报警

4. **持仓数据持久化** ❌ 缺失
   - 持仓信息保存（防止程序重启丢失）
   - 交易历史记录
   - 性能指标存储

5. **通知系统** ⚠️ 基础功能
   - Telegram 通知
   - 邮件通知
   - 关键事件报警

---

## 💰 资金分配策略

### 方案一：保守型（推荐新手）

**总资金：$10,000**

```
├─ 应急储备 (20%): $2,000  ← 不参与交易，应对极端情况
│
├─ 活跃交易 (60%): $6,000  ← 实际用于交易
│  ├─ 配对1 (Top 1):  $2,000 (33%)
│  ├─ 配对2 (Top 2):  $1,500 (25%)
│  ├─ 配对3 (Top 3):  $1,200 (20%)
│  ├─ 配对4 (Top 4):  $800  (13%)
│  └─ 配对5 (Top 5):  $500  (9%)
│
└─ 机动资金 (20%): $2,000  ← 用于补充保证金或新机会
```

**特点**：
- 只交易前5名配对
- Top配对分配更多资金
- 保留充足的应急资金

### 方案二：平衡型

**总资金：$50,000**

```
├─ 应急储备 (15%): $7,500
│
├─ 活跃交易 (70%): $35,000
│  ├─ 主力配对 (前3名): $21,000 (60%)
│  │  ├─ 配对1: $9,000
│  │  ├─ 配对2: $7,000
│  │  └─ 配对3: $5,000
│  │
│  └─ 辅助配对 (4-10名): $14,000 (40%)
│     └─ 7个配对，每个 $2,000
│
└─ 机动资金 (15%): $7,500
```

**特点**：
- 交易10个配对，分散风险
- 主力配对获得更多资金
- 适合有经验的交易者

### 方案三：激进型（不推荐新手）

**总资金：$100,000+**

```
├─ 应急储备 (10%): $10,000
│
├─ 活跃交易 (80%): $80,000
│  ├─ 一线配对 (前5名): $50,000 (62.5%)
│  ├─ 二线配对 (6-15名): $20,000 (25%)
│  └─ 三线配对 (16-20名): $10,000 (12.5%)
│
└─ 机动资金 (10%): $10,000
```

**特点**：
- 交易20个配对，高度分散
- 需要强大的监控系统
- 要求丰富的交易经验

---

## 📊 配对选择标准

### 不要只看收益率！综合考虑以下因素：

| 指标 | 重要性 | 说明 |
|------|--------|------|
| **收益率** | ⭐⭐⭐⭐ | 必须为正，建议 >5% |
| **夏普比率** | ⭐⭐⭐⭐⭐ | >1.0 为好，>1.5 为优秀 |
| **最大回撤** | ⭐⭐⭐⭐⭐ | <10% 为好，<20% 可接受 |
| **胜率** | ⭐⭐⭐ | >55% 为好 |
| **交易次数** | ⭐⭐⭐ | 8-30次为适中 |
| **相关性** | ⭐⭐⭐⭐ | >0.75，且在回测期内稳定 |
| **流动性** | ⭐⭐⭐⭐⭐ | 必须是主流币对 |

### 建议的筛选流程

```
1. 初步筛选（300个配对）
   ↓
   - 收益率 > 5%
   - 夏普比率 > 1.0
   - 最大回撤 < 20%
   - 交易次数 > 5
   ↓
2. 精细筛选（约30-50个配对）
   ↓
   - 检查流动性（是否为主流币种）
   - 检查相关性稳定性
   - 避免高度重叠的配对（如都含ETH）
   ↓
3. 最终选择（5-20个配对）
   ↓
   - 按综合得分排序
   - 确保配对之间分散
   - 根据资金量决定数量
```

---

## 🔧 开始实盘交易的步骤

### 第一步：完善系统（重要！）

在 `src/statistical-arbitrage/` 下需要添加：

1. **交易执行器** (`LiveTradeExecutor.js`)
   - 实际下单功能
   - 订单状态跟踪
   - 滑点控制

2. **持仓管理器** (`PositionManager.js`)
   - 持仓数据持久化
   - 多配对持仓管理
   - 保证金监控

3. **风险管理器** (`LiveRiskManager.js`)
   - 实时PnL监控
   - 回撤检测和熔断
   - 每日亏损限制

4. **通知系统** (增强现有的)
   - 开平仓通知
   - 风险警报
   - 每日报告

### 第二步：小额测试

```bash
# 1. 修改配置，使用小额资金
# config.js 中设置：
# - initialCapital: 1000  (小额测试)
# - tradeAmount: 200      (每次交易金额)
# - maxPositions: 2       (最多2个持仓)
# - enableLiveTrading: true

# 2. 只选择1-2个配对测试
npm run stat-arb  # 启动实盘
```

### 第三步：监控和调整

- 每天查看交易日志
- 监控实际滑点和手续费
- 对比回测和实盘表现
- 及时调整参数

### 第四步：逐步扩大

- 小额测试成功后（1-2周）
- 逐步增加资金和配对数量
- 保持谨慎的风险管理

---

## 🚨 风险控制建议

### 单配对层面

```javascript
// 建议在 config.js 中设置
{
  // 单配对最大仓位
  maxPositionSize: 0.2,  // 不超过总资金的20%
  
  // 止损阈值（不要设太宽）
  stopLossThreshold: 4.0,  // Z-score超过4立即止损
  
  // 最大持仓时间
  maxHoldingHours: 72,  // 超过3天强制平仓
}
```

### 账户层面

```javascript
{
  // 最大回撤限制
  maxDrawdown: 15,  // 回撤超过15%暂停交易
  
  // 每日最大亏损
  maxDailyLoss: 500,  // 单日亏损超过$500停止
  
  // 同时持仓数限制
  maxPositions: 5,  // 最多5个配对同时持仓
  
  // 每日交易次数限制
  dailyTradeLimit: 20  // 防止过度交易
}
```

---

## 📱 监控建议

### 实时监控（必须）

- 使用 Telegram Bot 接收实时通知
- 监控内容：
  - 开仓/平仓通知
  - 实时PnL变化
  - 风险警报

### 每日检查（推荐）

- 查看交易日志
- 检查持仓情况
- 审查异常交易
- 对比回测表现

### 每周复盘（建议）

- 计算周收益率和夏普比率
- 分析失败交易原因
- 评估配对表现
- 调整策略参数

---

## 💡 常见问题

### Q1: 实盘收益为什么比回测低？

**原因**：
1. 滑点：实际成交价格与预期不同（通常1-5个基点）
2. 延迟：获取数据和执行交易有延迟
3. 手续费：回测中可能低估了实际手续费
4. 市场变化：历史规律可能不再适用

**建议**：
- 预期实盘收益为回测的60-80%
- 使用限价单减少滑点
- 选择流动性好的交易对

### Q2: 如何判断策略失效？

**警告信号**：
1. 连续5个以上亏损交易
2. 胜率持续低于40%
3. 配对相关性明显下降（<0.6）
4. 回撤超过回测最大回撤的1.5倍

**应对措施**：
- 立即停止该配对的交易
- 重新回测最近数据
- 考虑更换配对或调整参数

### Q3: 如何应对黑天鹅事件？

**预防措施**：
1. 保留充足的应急资金（至少20%）
2. 设置严格的止损
3. 避免高杠杆
4. 分散到多个配对

**紧急处理**：
1. 市场剧烈波动时，手动平掉所有仓位
2. 暂停交易观察市场
3. 等待市场稳定后再重启

---

## 📈 推荐的起步方案

### 新手入门方案（$5,000-$10,000）

1. **配对数量**：3-5个
2. **每配对资金**：$1,000-$2,000
3. **测试期**：至少2周
4. **目标收益**：5-10% 月收益
5. **可接受回撤**：<10%

### 进阶方案（$20,000-$50,000）

1. **配对数量**：8-12个
2. **每配对资金**：$1,500-$4,000
3. **测试期**：至少1个月
4. **目标收益**：8-15% 月收益
5. **可接受回撤**：<15%

---

## ✅ 准备就绪的标志

**当你能确信地回答以下问题时，就可以开始实盘了：**

- [ ] 我理解统计套利的原理和风险
- [ ] 我已经完成充分的回测和参数优化
- [ ] 我有明确的资金管理计划
- [ ] 我设置了严格的风险控制措施
- [ ] 我建立了完善的监控机制
- [ ] 我准备好接受可能的亏损
- [ ] 我不会投入无法承受损失的资金
- [ ] 我有应对异常情况的预案

---

## 🎯 下一步行动

1. **立即**：安装并测试实盘交易模块（我将为你创建）
2. **本周**：用小额资金进行纸上交易测试
3. **下周**：如果测试成功，开始真实小额交易
4. **持续**：监控、学习、优化

记住：**稳定比快速更重要，保本比暴利更关键！** 🚀

