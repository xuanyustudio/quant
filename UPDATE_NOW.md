# 🚀 立即更新实盘系统

## 问题

您的实盘交易系统没有显示币对的详细信息（价格、Z-Score等），只显示统计信息。

**原因：** `runLive` 方法没有从配置文件中加载交易对。

---

## ✅ 已修复

1. ✅ `runLive` 方法现在会从配置文件加载交易对
2. ✅ 添加了完整的错误处理
3. ✅ 添加了数据验证
4. ✅ 每次检查时会显示完整的币对信息（价格、Z-Score、相关性等）

---

## 📦 更新步骤（在服务器上执行）

### 第1步：上传新文件

将修改后的 `src/statistical-arbitrage/index.js` 上传到服务器。

**方法A：使用Git（如果有）**
```bash
git pull
```

**方法B：直接上传**
使用SCP/FTP上传文件到服务器的 `src/statistical-arbitrage/index.js`

### 第2步：重启PM2

```bash
# 重启实盘交易
pm2 restart stat-arb

# 查看日志
pm2 logs stat-arb
```

---

## 🎯 更新后的预期输出

```
═══════════════════════════════════════════════════════
🔍 第 1 次检查 [2025/10/28 23:00:00]
═══════════════════════════════════════════════════════

───────────────────────────────────────────────────────
📊 ID/USDT / HOOK/USDT [2025/10/28 23:00:01]
   💰 当前价格: ID/USDT=$0.50123456 | HOOK/USDT=$0.39876543
   📈 价格比率: 1.2567
   📊 相关系数: 0.823 ✨
   📉 价差统计: 当前=0.102345 | 均值=0.098765 | 标准差=0.003456
   🎯 Z-Score: 1.04
   📏 阈值: 开仓=3.1 | 平仓=0.6 | 止损=4.75
   ⏸️ 信号: HOLD - 观望: Z=1.04
   💼 持仓状态: 无持仓

───────────────────────────────────────────────────────
📊 MINA/USDT / POLYX/USDT [2025/10/28 23:00:03]
   💰 当前价格: MINA/USDT=$0.65432100 | POLYX/USDT=$0.31234567
   📈 价格比率: 2.0951
   📊 相关系数: 0.789 ✅
   📉 价差统计: 当前=0.345678 | 均值=0.341234 | 标准差=0.002345
   🎯 Z-Score: 1.90
   📏 阈值: 开仓=3.1 | 平仓=0.6 | 止损=4.75
   ⏸️ 信号: HOLD - 观望: Z=1.90
   💼 持仓状态: 无持仓

═══════════════════════════════════════════════════════
📊 累计统计: 暂无交易记录
⏰ 等待 60 秒后进行下一次检查...
   下次检查时间: 2025/10/28 23:01:00
═══════════════════════════════════════════════════════
```

---

## 🔍 验证更新成功

运行以下命令：

```bash
pm2 logs stat-arb --lines 100
```

如果看到类似上面的输出（包含每个币对的详细信息），说明更新成功！✅

---

## 🆘 如果出现问题

### 问题1：还是没有显示币对信息

```bash
# 检查错误日志
pm2 logs stat-arb --err

# 可能看到的错误：
# "❌ 未找到交易配对配置！"
```

**解决方法：** 检查配置文件路径是否正确

```bash
# 查看配置文件
cat output/live_trading_config_*.json | grep -A 10 '"pairs"'

# 检查 ecosystem.config.cjs
cat ecosystem.config.cjs | grep args
```

### 问题2：语法错误

```bash
# 检查语法
node --check src/statistical-arbitrage/index.js

# 如果有错误，重新上传文件
```

### 问题3：进程崩溃

```bash
# 查看错误
pm2 logs stat-arb --err --lines 50

# 完全重启
pm2 delete stat-arb
pm2 start ecosystem.config.cjs
```

---

## 💡 快速命令（一键更新）

如果您已经上传了新文件，直接运行：

```bash
pm2 restart stat-arb && sleep 2 && pm2 logs stat-arb --lines 50
```

---

## ✅ 修改清单

修改的文件：
- `src/statistical-arbitrage/index.js` (行 701-892)

主要修改：
1. 在 `runLive()` 开始时从 `strategyConfig.tradingPairs` 初始化 `this.selectedPairs`
2. 添加配置验证（如果没有交易对，报错并退出）
3. 添加每个币对处理的 try-catch 错误处理
4. 添加数据验证（检查价格数据是否为空）
5. 更详细的日志输出

---

祝更新顺利！🎉

