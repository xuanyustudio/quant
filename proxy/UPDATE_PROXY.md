# æ›´æ–°ä»£ç†æœåŠ¡å™¨æ­¥éª¤

## ğŸš€ å¿«é€Ÿæ›´æ–°

### æ–¹æ³• 1: ä½¿ç”¨ SCP ä¸Šä¼ ï¼ˆæ¨èï¼‰

åœ¨**æœ¬åœ° PowerShell** è¿è¡Œï¼š

```powershell
# 1. ä¸Šä¼ æ–°ç‰ˆæœ¬
scp d:\work\web3\proxy\server.js root@image.h4yx.com:/opt/proxy/server.js

# 2. ä¸Šä¼ è¯Šæ–­å·¥å…·
scp d:\work\web3\proxy\diagnose.js root@image.h4yx.com:/opt/proxy/diagnose.js

# 3. SSH åˆ°æœåŠ¡å™¨
ssh root@image.h4yx.com
```

åœ¨**æœåŠ¡å™¨ä¸Š**è¿è¡Œï¼š

```bash
# 4. å…ˆè¿è¡Œè¯Šæ–­ï¼ˆç¡®è®¤æœåŠ¡å™¨èƒ½è®¿é—®å¸å®‰ï¼‰
cd /opt/proxy
node diagnose.js

# 5. å¦‚æœè¯Šæ–­é€šè¿‡ï¼Œé‡å¯ä»£ç†
pm2 restart bina
pm2 logs bina --lines 20
```

---

### æ–¹æ³• 2: ç›´æ¥ç²˜è´´ä»£ç 

å¦‚æœ SCP ä¸å¯ç”¨ï¼š

```bash
# 1. SSH åˆ°æœåŠ¡å™¨
ssh root@image.h4yx.com

# 2. ç¼–è¾‘æ–‡ä»¶
cd /opt/proxy
vi server.js

# 3. æŒ‰ 'i' è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œåˆ é™¤æ‰€æœ‰å†…å®¹ï¼ˆggdGï¼‰
# 4. ç²˜è´´æ–°ä»£ç ï¼ˆä»æœ¬åœ°å¤åˆ¶ d:\work\web3\proxy\server.jsï¼‰
# 5. æŒ‰ ESCï¼Œè¾“å…¥ :wq ä¿å­˜

# 6. é‡å¯
pm2 restart bina
```

---

## ğŸ” è¯Šæ–­æ­¥éª¤

### åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œè¯Šæ–­

```bash
cd /opt/proxy
node diagnose.js
```

**é¢„æœŸè¾“å‡ºï¼ˆæˆåŠŸï¼‰ï¼š**
```
ğŸ” ä»£ç†æœåŠ¡å™¨è¯Šæ–­å·¥å…·
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æµ‹è¯• 1: ä»£ç†æœåŠ¡å™¨èƒ½å¦è§£æ api.binance.com DNS
âœ… DNS è§£ææˆåŠŸ: 76.223.x.x

æµ‹è¯• 2: ä»£ç†æœåŠ¡å™¨èƒ½å¦å»ºç«‹åˆ°å¸å®‰çš„ TCP è¿æ¥
âœ… TCP è¿æ¥æˆåŠŸ: api.binance.com:443

æµ‹è¯• 3: ä»£ç†æœåŠ¡å™¨èƒ½å¦å®Œæˆ HTTPS è¯·æ±‚
âœ… HTTPS è¯·æ±‚æˆåŠŸ: HTTP 200

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

**å¦‚æœè¯Šæ–­å¤±è´¥ï¼š**
```
âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼

å¯èƒ½çš„åŸå› ï¼š
â€¢ ä»£ç†æœåŠ¡å™¨æœ¬èº«æ— æ³•è®¿é—®å¸å®‰ï¼ˆè¢«å¢™/é˜²ç«å¢™ï¼‰
â€¢ DNS è§£æé—®é¢˜
â€¢ ç½‘ç»œé…ç½®é—®é¢˜
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. **æ›´æ¢æœåŠ¡å™¨**ï¼šé€‰æ‹©èƒ½è®¿é—®å¸å®‰çš„æµ·å¤–æœåŠ¡å™¨
2. **ä½¿ç”¨ OKX**ï¼šå›½å†…å¯ç›´è¿ï¼Œæ— éœ€ä»£ç†ï¼ˆæ¨èï¼‰

---

## ğŸ§ª åœ¨æœ¬åœ°æµ‹è¯•ä»£ç†

æ›´æ–°æœåŠ¡å™¨åï¼Œåœ¨**æœ¬åœ°**è¿è¡Œï¼š

```powershell
cd d:\work\web3
node test-local-proxy.js
```

**é¢„æœŸè¾“å‡ºï¼ˆæˆåŠŸï¼‰ï¼š**
```
æµ‹è¯• 3: é€šè¿‡è¿œç¨‹ä»£ç†è®¿é—®ï¼ˆimage.h4yx.com:3000ï¼‰...
âœ… è¿œç¨‹ä»£ç†è®¿é—®æˆåŠŸ: 2025-10-24 23:xx:xx
   ğŸ’¡ è¿œç¨‹ä»£ç†å·¥ä½œæ­£å¸¸ï¼
```

**æœåŠ¡å™¨æ—¥å¿—ï¼ˆæˆåŠŸï¼‰ï¼š**
```
[CONNECT] api.binance.com:443
âœ“ éš§é“å·²å»ºç«‹: api.binance.com:443
â†“ è¿æ¥å…³é—­: api.binance.com:443
```

**ä¸åº”è¯¥å†æœ‰ï¼š**
```
âœ— å®¢æˆ·ç«¯é”™è¯¯: read ECONNRESET  âŒ è¿™ä¸ªé”™è¯¯
```

---

## ğŸ“Š å…³é”®ä¿®æ”¹è¯´æ˜

### æ–°ç‰ˆæœ¬æ”¹è¿›ï¼š

1. **ç®€åŒ– pipe é€»è¾‘**ï¼šç§»é™¤å¯èƒ½å¹²æ‰°æ•°æ®æµçš„ç»Ÿè®¡ä»£ç 
2. **å¿½ç•¥ ECONNRESET**ï¼šå®¢æˆ·ç«¯æ­£å¸¸æ–­å¼€ä¸å†æŠ¥é”™
3. **æ”¹è¿›é”™è¯¯å¤„ç†**ï¼šé¿å…çº§è”å…³é—­å¯¼è‡´çš„é—®é¢˜
4. **æ ‡å‡†åŒ–å®ç°**ï¼šéµå¾ª Node.js å®˜æ–¹ CONNECT ä»£ç†æœ€ä½³å®è·µ

### æ ¸å¿ƒä»£ç ï¼š

```javascript
server.on('connect', (req, clientSocket, head) => {
  const serverSocket = net.connect(port, hostname, () => {
    clientSocket.write('HTTP/1.1 200 Connection Established\r\n\r\n');
    
    // ç«‹å³è½¬å‘é¢„è¯»æ•°æ®
    if (head && head.length > 0) {
      serverSocket.write(head);
    }
    
    // å»ºç«‹åŒå‘é€æ˜è½¬å‘
    serverSocket.pipe(clientSocket);
    clientSocket.pipe(serverSocket);
  });
  
  // ... é”™è¯¯å¤„ç†
});
```

---

## âš ï¸ å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

### å¯èƒ½çš„æ ¹æœ¬åŸå› ï¼š

**ä½ çš„ä»£ç†æœåŠ¡å™¨ï¼ˆimage.h4yx.comï¼‰æœ¬èº«æ— æ³•è®¿é—®å¸å®‰ï¼**

è¿è¡Œè¯Šæ–­å·¥å…·ä¼šå‘Šè¯‰ä½ ç­”æ¡ˆï¼š
```bash
cd /opt/proxy
node diagnose.js
```

å¦‚æœè¯Šæ–­å¤±è´¥ï¼Œæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š

### é€‰æ‹© 1: æ›´æ¢ä»£ç†æœåŠ¡å™¨
æ‰¾ä¸€ä¸ª**çœŸæ­£èƒ½è®¿é—®å¸å®‰çš„æµ·å¤–æœåŠ¡å™¨**ï¼Œç„¶åéƒ¨ç½²ä»£ç†ã€‚

### é€‰æ‹© 2: ä½¿ç”¨ OKXï¼ˆæ¨èï¼‰â­
OKX åœ¨å›½å†…å¯ç›´è¿ï¼Œæ— éœ€ä»£ç†ï¼

ä¿®æ”¹ `src/statistical-arbitrage/config.js`ï¼š
```javascript
export default {
  exchange: {
    id: 'okx',  // ä½¿ç”¨ OKX
    apiKey: process.env.OKX_API_KEY || '',
    secret: process.env.OKX_SECRET || '',
    password: process.env.OKX_PASSWORD || '',  // OKX éœ€è¦ password
    // ... æ— éœ€ä»»ä½•ä»£ç†é…ç½®
  },
  // ...
};
```

ç„¶åç›´æ¥è¿è¡Œï¼š
```powershell
npm run stat-arb:backtest
```

---

## âœ… ä¸‹ä¸€æ­¥

1. âœ… æ›´æ–°æœåŠ¡å™¨ä»£ç 
2. âœ… è¿è¡Œè¯Šæ–­å·¥å…·
3. âœ… æµ‹è¯•ä»£ç†è¿æ¥
4. âœ… è¿è¡Œç»Ÿè®¡å¥—åˆ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œ**ä¸è¦çº ç»“ä»£ç†**ï¼Œç›´æ¥ç”¨ OKXï¼

