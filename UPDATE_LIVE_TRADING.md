# 🔄 更新实盘交易系统

## 更新内容

✅ **增加详细的实时状态输出**

每次价格检查时会显示：
- 💰 当前价格（两个币种）
- 📈 价格比率
- 📊 相关系数（含评级）
- 📉 价差统计（当前、均值、标准差）
- 🎯 Z-Score（当前值）
- 📏 交易阈值（开仓、平仓、止损）
- 🚦 交易信号（HOLD/OPEN_LONG/OPEN_SHORT/CLOSE）
- 💼 持仓状态（如果有持仓）
- 💚/❤️ 浮动盈亏（如果有持仓）

---

## 🚀 如何更新（在服务器上操作）

### 方法1：重启PM2（推荐）

```bash
# 1. 停止当前进程
pm2 stop stat-arb

# 2. 上传最新代码（如果使用Git）
git pull

# 3. 重新启动
pm2 start ecosystem.config.cjs

# 4. 查看新的日志输出
pm2 logs stat-arb
```

### 方法2：直接重启（如果代码已更新）

```bash
# 重启PM2进程
pm2 restart stat-arb

# 查看日志
pm2 logs stat-arb --lines 50
```

---

## 📊 新的日志输出示例

```
═════════════════════════════════════════════════════════
🔍 第 1 次检查 [2025/10/28 17:00:00]
═════════════════════════════════════════════════════════

────────────────────────────────────────────────────────
📊 ID/USDT / HOOK/USDT [2025/10/28 17:00:01]
   💰 当前价格: ID/USDT=$0.50123456 | HOOK/USDT=$0.39876543
   📈 价格比率: 1.2567
   📊 相关系数: 0.823 ✨
   📉 价差统计: 当前=0.102345 | 均值=0.098765 | 标准差=0.003456
   🎯 Z-Score: 1.04
   📏 阈值: 开仓=3.1 | 平仓=0.6 | 止损=4.75
   ⏸️ 信号: HOLD - 观望: Z=1.04
   💼 持仓状态: 无持仓

────────────────────────────────────────────────────────
📊 MINA/USDT / POLYX/USDT [2025/10/28 17:00:03]
   💰 当前价格: MINA/USDT=$0.65432100 | POLYX/USDT=$0.31234567
   📈 价格比率: 2.0951
   📊 相关系数: 0.789 ✅
   📉 价差统计: 当前=0.345678 | 均值=0.341234 | 标准差=0.002345
   🎯 Z-Score: 1.90
   📏 阈值: 开仓=3.1 | 平仓=0.6 | 止损=4.75
   ⏸️ 信号: HOLD - 观望: Z=1.90
   💼 持仓状态: 无持仓

═════════════════════════════════════════════════════════
📊 累计统计: 暂无交易记录
⏰ 等待 60 秒后进行下一次检查...
   下次检查时间: 2025/10/28 17:01:00
═════════════════════════════════════════════════════════
```

---

## 🎯 信号类型图标说明

| 图标 | 信号类型 | 说明 |
|------|---------|------|
| 🟢 | OPEN_LONG | 做多价差（ID相对HOOK便宜，买ID卖HOOK） |
| 🔴 | OPEN_SHORT | 做空价差（ID相对HOOK昂贵，卖ID买HOOK） |
| 🔵 | CLOSE | 平仓信号（价差回归均值） |
| 🛑 | STOP_LOSS | 止损信号（价差继续背离） |
| ⏸️ | HOLD | 持有/观望（无交易信号） |

---

## 📊 相关系数评级

| 符号 | 相关性 | 评级 |
|------|-------|------|
| ✨ | ≥ 0.8 | 优秀 |
| ✅ | 0.7-0.8 | 良好 |
| ⚠️ | < 0.7 | 警告（可能不交易） |

---

## 🔥 Z-Score提示

- **🔥** 图标表示 Z-Score 绝对值 > 2（接近开仓阈值）
- 数值正负号：
  - **正值**: ID 相对 HOOK 昂贵（做空价差机会）
  - **负值**: ID 相对 HOOK 便宜（做多价差机会）

---

## 💼 持仓状态

如果有持仓，会额外显示：
```
💼 持仓状态: OPEN_LONG (开仓于 2025/10/28 16:30:00)
📌 开仓Z-Score: -3.25
💚 浮动盈亏: +12.50 USDT (+6.25%)
```

---

## 🆘 如果更新后出现错误

### 1. 查看错误日志

```bash
pm2 logs stat-arb --err --lines 50
```

### 2. 检查代码语法

```bash
node --check src/statistical-arbitrage/index.js
```

### 3. 回滚到之前的版本

```bash
# 停止进程
pm2 stop stat-arb

# 回滚Git（如果使用）
git checkout HEAD~1 src/statistical-arbitrage/index.js

# 重启
pm2 restart stat-arb
```

### 4. 完全重启

```bash
pm2 delete stat-arb
pm2 start ecosystem.config.cjs
pm2 save
```

---

## ✅ 验证更新成功

运行后应该看到：
1. ✅ 每分钟输出检查周期编号和时间
2. ✅ 每个币对显示详细的价格、Z-Score、相关性等信息
3. ✅ 显示持仓状态（有或无）
4. ✅ 显示下次检查时间

---

## 💡 提示

- 新的日志输出会更详细，建议使用 `pm2 logs stat-arb` 实时查看
- 如果日志太多，可以只查看错误：`pm2 logs stat-arb --err`
- 定期检查 `logs/combined.log` 查看历史记录

---

祝交易顺利！💰

