# 🚀 实盘交易启动指南

## 📋 **启动步骤（按顺序执行）**

---

## **第1步：配置币安API密钥**

### 1.1 创建API密钥

1. 登录币安账户
2. 进入 **API管理** 页面
3. 点击 **创建API**
4. 选择 **系统生成** 类型
5. 输入标签名称（如 `StatArb-Bot`）
6. 完成身份验证（2FA）

### 1.2 设置API权限

⚠️ **重要：只启用以下权限**

- [x] **启用现货与杠杆交易**
- [ ] 启用合约交易（不要勾选）
- [ ] 启用提现（不要勾选，安全考虑）
- [ ] 其他权限都不需要

### 1.3 保存API密钥

创建项目根目录下的 `.env` 文件：

```bash
# 币安API配置
BINANCE_API_KEY=你的API_Key
BINANCE_SECRET=你的Secret_Key

# 代理配置（国内用户需要）
HTTPS_PROXY=http://127.0.0.1:7897

# 交易所选择（统计套利使用币安）
EXCHANGE=binance
```

⚠️ **安全提示：**
- 永远不要将 `.env` 文件上传到GitHub
- 定期更换API密钥
- 启用IP白名单（在币安API设置中）

---

## **第2步：验证配置**

### 2.1 检查配置文件

运行系统检查：

```bash
npm run stat-arb:check
```

应该看到：
```
✅ 配置文件加载成功
✅ 交易参数合理
✅ 风险控制参数已设置
```

### 2.2 测试API连接

创建测试脚本或运行：

```bash
# 测试币安连接
node src/scripts/test-connection.js
```

应该看到：
```
✅ 币安 API连接成功
✅ 账户余额查询正常
```

---

## **第3步：审查实盘配置**

### 3.1 打开配置文件

```bash
code output/live_trading_config_xxxxxx.json
```

### 3.2 确认关键参数

**资金分配：**
```json
"funds": {
  "reserve": 200,    // 应急储备 20%
  "active": 600,     // 活跃交易 60%
  "mobile": 200      // 机动资金 20%
}
```

**交易对：**
```json
"pairs": [
  {
    "symbols": ["ID/USDT", "HOOK/USDT"],
    "tradeAmount": 200  // 每笔交易金额
  }
]
```

**风险控制：**
```json
"riskControl": {
  "maxDrawdown": 15,       // 最大回撤15%
  "maxDailyLoss": 50,      // 单日最大亏损$50
  "maxPositions": 2,       // 最大持仓数2
  "stopLossMultiplier": 1.5
}
```

⚠️ **如果参数不对，请重新运行 portfolio-optimizer**

---

## **第4步：小额测试（必须！）**

### 4.1 修改配置为测试模式

编辑 `src/statistical-arbitrage/config.js`：

```javascript
// 测试模式配置
export default {
  // 使用小额资金测试
  initialCapital: 200,  // 只用$200测试
  tradeAmount: 50,      // 单笔$50
  maxPositions: 1,      // 只开1个仓位
  
  // 其他参数保持不变...
}
```

### 4.2 启动测试

```bash
# 确保代理已启动（国内用户）
# 启动实盘交易（测试模式）
npm run stat-arb -- --live
```

### 4.3 观察测试结果（3-7天）

**每天检查：**
- [ ] 订单执行是否正常
- [ ] 滑点是否在预期范围（<0.5%）
- [ ] 止损是否正确触发
- [ ] 日志是否记录完整
- [ ] 盈亏是否符合预期

**如果测试失败：**
1. 分析失败原因
2. 调整参数
3. 重新测试
4. 不要急于上全部资金！

---

## **第5步：正式启动实盘**

### 5.1 确认测试通过

- [x] 测试至少运行3-7天
- [x] 执行效果符合预期
- [x] 未出现异常错误
- [x] 实际滑点可接受
- [x] 风控机制正常运作

### 5.2 恢复正式配置

编辑 `src/statistical-arbitrage/config.js`，使用您的实际参数：

```javascript
export default {
  initialCapital: 1000,  // 您的实际资金
  tradeAmount: 200,      // 根据配置文件
  maxPositions: 2,       // 根据配置文件
  // ... 其他参数
}
```

### 5.3 启动实盘交易

```bash
# 最终确认
npm run stat-arb:check

# 启动实盘！
npm run stat-arb -- --live
```

---

## **第6步：持续监控**

### 6.1 设置监控提醒

**每日检查（必须）：**
- 早上：检查夜间交易情况
- 中午：查看当日盈亏
- 晚上：检查持仓和风险

**每周复盘（建议）：**
- 统计周度盈亏
- 分析交易记录
- 评估策略效果
- 调整参数（谨慎）

### 6.2 关键监控指标

在日志中查看：

```bash
# 查看交易日志
tail -f logs/trades.log

# 查看错误日志
tail -f logs/error.log

# 查看综合日志
tail -f logs/combined.log
```

**关注这些指标：**
- 当日收益：$___ / ___%
- 累计收益：$___ / ___%
- 当前回撤：___%
- 胜率：___%
- 持仓情况：___

### 6.3 日常维护

**每天：**
- [ ] 检查系统是否正常运行
- [ ] 确认API连接稳定
- [ ] 查看交易执行情况
- [ ] 记录异常和问题

**每周：**
- [ ] 备份交易数据
- [ ] 复盘交易决策
- [ ] 评估策略效果
- [ ] 更新监控图表

**每月：**
- [ ] 更换API密钥
- [ ] 深度复盘分析
- [ ] 策略优化评估
- [ ] 风险暴露检查

---

## **第7步：风险管理（最重要！）**

### 7.1 严格执行止损

**自动止损触发条件：**

1. **单笔交易止损**
   - 亏损超过 ___% → 立即平仓

2. **单日止损**
   - 当日亏损超过 $___ → 停止交易

3. **总回撤止损**
   - 总回撤超过 ___% → 暂停交易3天

4. **连续亏损止损**
   - 连续3天亏损 → 暂停交易，复盘分析

### 7.2 盈利保护

**达到盈利目标后：**

- 盈利5% → 提取2.5%本金到冷钱包
- 盈利10% → 提取5%本金
- 盈利20% → 提取10%本金

**永远记住：落袋为安！**

### 7.3 紧急停止交易

**立即停止的情况：**

1. **技术故障**
   - API频繁报错
   - 订单执行异常
   - 系统崩溃

2. **市场异常**
   - 流动性突然枯竭
   - 价格剧烈波动
   - 交易所故障

3. **策略失效**
   - 胜率低于30%
   - 连续5天亏损
   - 回撤超过25%

4. **个人原因**
   - 无法正常监控
   - 心态严重失衡
   - 风险承受力变化

---

## **第8步：记录与复盘**

### 8.1 交易日志模板

创建 `trading_journal.xlsx` 或使用Google Sheets：

| 日期 | 配对 | 方向 | 开仓价 | 平仓价 | 盈亏 | 备注 |
|------|------|------|--------|--------|------|------|
| 2025-10-28 | ID/HOOK | 做多价差 | 1.025 | 1.032 | +$15 | 执行顺利 |

### 8.2 每日总结

**每天记录：**
- 当日盈亏：$___
- 交易次数：___
- 成功率：___%
- 最大回撤：___%
- 遇到的问题：___
- 解决方案：___

### 8.3 周度复盘

**每周分析：**
1. 本周总盈亏
2. 最成功的交易
3. 最失败的交易
4. 策略效果评估
5. 下周改进计划

---

## **第9步：优化与迭代**

### 9.1 何时调整参数

**可以调整的情况：**
- 连续2周表现稳定
- 有明确的优化依据
- 经过充分测试验证

**不要调整的情况：**
- 刚开始几天
- 情绪波动时
- 单次交易失败后
- 没有数据支持

### 9.2 参数调整流程

1. **识别问题** → 分析数据找出具体问题
2. **提出假设** → 为什么调整这个参数
3. **小幅测试** → 先用小额测试新参数
4. **验证效果** → 至少运行1-2周
5. **决定采用** → 效果确实更好才采用

### 9.3 长期优化方向

**前3个月：**
- 专注于执行
- 积累数据
- 不要频繁调整

**3-6个月：**
- 开始优化参数
- 尝试新配对
- 扩大资金规模

**6个月后：**
- 全面评估策略
- 考虑自动化升级
- 研究新策略

---

## 📊 **关键指标参考**

### 正常表现范围：

| 指标 | 保守 | 平衡 | 激进 |
|------|------|------|------|
| 月收益率 | 2-5% | 5-10% | 10-20% |
| 夏普比率 | >1.5 | >1.2 | >1.0 |
| 最大回撤 | <10% | <15% | <20% |
| 胜率 | >60% | >55% | >50% |
| 月交易次数 | 10-30 | 30-60 | 60-100 |

**如果偏离这些范围，需要分析原因！**

---

## 🆘 **常见问题处理**

### Q1: 订单一直不成交怎么办？

**原因：** 限价单价格偏离市价太多

**解决：**
1. 检查挂单价格
2. 适当放宽价格范围（0.1-0.2%）
3. 如果急需成交可用市价单（但要接受滑点）

### Q2: 回测盈利但实盘亏损？

**可能原因：**
1. 滑点比预期大
2. 手续费计算不准确
3. 市场环境变化
4. 回测过拟合

**解决：**
1. 降低交易频率
2. 使用更宽的价差阈值
3. 重新回测近期数据
4. 暂停交易，重新优化

### Q3: API频繁报错？

**检查：**
1. 代理是否正常
2. API权限是否正确
3. IP是否被限制
4. 请求频率是否超限

**解决：**
1. 重启代理
2. 检查API设置
3. 添加IP白名单
4. 增加请求延迟

---

## ✅ **启动前最后确认**

在运行 `npm run stat-arb -- --live` 之前，请确认：

- [x] 已完成 `PRE_LIVE_CHECKLIST.md` 所有检查项
- [x] API密钥已正确配置
- [x] 已完成小额测试
- [x] 配置文件已审查
- [x] 止损策略已设置
- [x] 监控系统已准备
- [x] 紧急预案已制定
- [x] 心态已调整好

**我已准备好！开始实盘！** 🚀

---

## 📞 **需要帮助？**

如果遇到问题：

1. **查看日志**：`logs/` 目录下的日志文件
2. **检查配置**：运行 `npm run stat-arb:check`
3. **重新测试**：用小额资金重新测试
4. **暂停交易**：有疑问时不要勉强继续

**记住：保护本金永远是第一位的！** 🛡️

---

**祝您交易顺利，稳定盈利！** 💰

